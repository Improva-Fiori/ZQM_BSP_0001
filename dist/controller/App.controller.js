sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","../model/formatter","sap/m/Text","sap/m/Button","sap/m/Dialog","sap/m/MessageView","sap/m/MessageItem","sap/ui/core/Fragment","sap/ui/core/BusyIndicator"],function(BaseController,MessageBox,formatter,Text,Button,Dialog,MessageView,MessageItem,Fragment,BusyIndicator){"use strict";var oData;return BaseController.extend("com.karsan.qm.sapmaportali.controller.App",{formatter:formatter,onInit:function(){oData=this.getOwnerComponent().getModel();oData.setSizeLimit(1e6)},getModel:function(e){return this.getView().getModel(e)},getViewModel:function(){return this.getView().getModel("viewModel")},getRouter:function(){return this.getOwnerComponent().getRouter()},getText(e){let t=this.getView().getModel("i18n").getResourceBundle();return t.getText(e)},showErrorMessageBox(e){MessageBox.error(this.getText(e))},confirmAction(e,t,s=1,r){let o=this;return new Promise(function(t){let n=o.getViewModel();let i="";let a=[];a.push(new sap.m.VBox({items:[new Text({text:e}),r]}));if(s===2||s===3||s===4){o._sRequired=false;if(s===4){o._sRequired=n.getProperty("/CopyByCancel")}else{o._sRequired=s===3}const e=new sap.m.TextArea({id:"IdConfirmActionDescription",placeholder:o.getText("EnterDescription"),maxLength:500,rows:4,width:"100%",required:o._sRequired,valueStateText:o.getText("Max500Chars"),liveChange:function(e){i=e.getParameter("value")}});a.push(new sap.m.VBox({items:[new sap.m.Label({text:o.getText("DescriptionLabel"),required:o._sRequired}),e]}))}var c=new Dialog({title:o.getText("AreYouSure"),type:"Message",state:"Warning",content:a,beginButton:new Button({text:o.getText("Yes"),type:"Emphasized",press:function(){if(o._sRequired&&!i.trim()){let e=c.getContent().length-1;let t=c.getContent()[e]?.getItems().find(e=>e.isA("sap.m.TextArea"));if(t){t.setValueState("Error");t.setValueStateText(o.getText("DescriptionRequired"))}return}c.close();t({confirmed:true,description:i})}}),endButton:new Button({text:o.getText("Cancel"),type:"Reject",press:function(){c.close();t({confirmed:false,description:""})}}),afterClose:function(){c.destroy()}});o.getView().addDependent(c);c.open()})},readEntity:function(e,t={}){return new Promise(function(s,r){oData.read("/"+e,{urlParameters:t.urlParameters||{},success:function(e){s(e)},error:function(e){r(e)}})})},readEntitySet:function(e,t={}){return new Promise(function(s,r){oData.read("/"+e,{filters:t.filters||[],urlParameters:t.urlParameters||{},success:function(e){s(e)},error:function(e){r(e)}})})},_showMessage:function(e){e=Array.isArray(e)?e:e?[e]:[];let t=this.getViewModel().getProperty("/Messages")||[];let s=this._formatMessage([...t,...e]);this.getViewModel().setProperty("/Messages",s);this.getViewModel().refresh(true);if(!s||s.length===0){return}const r=new MessageView;r.setModel(this.getViewModel(),"viewModel");r.unbindAggregation("items");r?.attachActiveTitlePress(function(e){const t=e.getParameter("item");if(t){const e=t.getBindingContext("viewModel").getProperty("controlId");if(e){const t=this.getView().byId(e);if(t){t.focus();if(e.startsWith("IdTab")){const t=e.replace("IdTab","");const s=this.getView().byId("IdTabBar");if(s){s.setSelectedKey(t)}}if(t.setValueState){t.setValueState("Error")}this.onCloseDMessages()}}}}.bind(this));r.bindAggregation("items",{model:"viewModel",path:"/Messages",templateShareable:false,template:new MessageItem({type:"{viewModel>type}",title:"{viewModel>title}",subtitle:"{viewModel>subtitle}",description:"{viewModel>description}",groupName:"{viewModel>groupName}",activeTitle:"{viewModel>activeTitle}"})});this._oDMessages=new Dialog({title:this.getText("DMessagesTitle")||"Mesajlar",type:"Message",contentWidth:"50%",contentHeight:"40%",resizable:true,draggable:true,state:"Information",content:[r],endButton:new Button({text:this.getText("Close")||"Kapat",press:function(){this.onCloseDMessages()}.bind(this)}),afterOpen:function(){const e=r.$();if(e&&e.length){const t=window.innerHeight||$(window).height();const s=Math.max(200,Math.round(t*.6)-120);e.css({height:s+"px",overflow:"auto"})}}});this.getView().addDependent(this._oDMessages);this._oMessageView=r;setTimeout(function(){this._oDMessages.open()}.bind(this),0)},_setValueStateByMessages:function(){let e=this.getViewModel().getProperty("/Messages")||[];e.forEach(e=>{if(e.controlId&&e.type==="Error"){this.getView().byId(e.controlId)?.setValueState("Error")}})},onCloseDMessages:function(){this._clearMessages();if(this._oDMessages){this._oDMessages.close()}let aAction=this.getViewModel().getProperty("/WaitingAction")||[];aAction.sort((e,t)=>e.seqnr-t.seqnr);aAction.forEach(oAction=>{eval(`${oAction.function}(oAction.event)`)});this.getViewModel().setProperty("/WaitingAction",[])},_formatMessage:function(e){if(!Array.isArray(e)){e=[e]}const t=e=>{if(!e){return"None"}switch(e){case"S":return"Success";case"W":return"Warning";case"E":return"Error";case"A":return"Error";case"X":return"Error";case"I":return"Information";default:return e}};const s=new Set;const r=[];if(!Array.isArray(e)){return r}e.forEach(e=>{const o=(e.description||e.Message||e.message||"").toString();if(!o){return}if(s.has(o)){return}s.add(o);const n={type:e.type||t(e.Type)||"None",title:(e.title||o).toString(),subtitle:(e.subtitle||e.Id+e.Number||"").toString(),description:o,groupName:(e.groupName||"").toString(),activeTitle:e.activeTitle||false,controlId:e.controlId||null};r.push(n)});return r},_addMessage:function(e){let t=this._formatMessage(e);let s=this.getViewModel().getProperty("/Messages")||[];t.forEach(e=>{const t=s.some(t=>t.description===e.description);if(!t){s.push(e)}});this.getViewModel().setProperty("/Messages",s)},_checkMessagesHasError:function(){let e=this.getViewModel().getProperty("/Messages")||[];return e.some(e=>e.type==="Error")},_clearMessages:function(){this.getViewModel().setProperty("/Messages",[])},getCurrentTimeEdmFormat(){const e=new Date;const t=e.getHours()*36e5+e.getMinutes()*6e4+e.getSeconds()*1e3;return{ms:t,__edmType:"Edm.Time"}},createDialog(e){return new Promise(t=>{Fragment.load({id:this.getView().getId(),name:`com.karsan.qm.servisbulten.view.fragment.Dialog.${e}`,controller:this}).then(e=>{this.getView().addDependent(e);t(e)})})},onCallFunction(e,t,s,r){return new Promise((o,n)=>{const i={method:t,urlParameters:r,success:o,error:n};s.callFunction(e,i)})},onCreate(e,t,s){return new Promise((r,o)=>{const n={success:r,error:o};s.create(e,t,n)})},onDelete(e,t){return new Promise((s,r)=>{const o={success:s,error:r};t.remove(e,o)})},onRead(e,t){return new Promise((s,r)=>{const o={success:s,error:r};t.read(e,o)})},onReadAssociation(e,t,s){return new Promise((r,o)=>{const n={urlParameters:t,success:r,error:o};s.read(e,n)})},onReadExpanded(e,t,s,r){return new Promise((o,n)=>{const i={filters:t,urlParameters:s,success:o,error:n};r.read(e,i)})},onReadQuery(e,t,s){return new Promise((r,o)=>{const n={filters:t,success:r,error:o};s.read(e,n)})},onReadQueryAsyncSorters(e,t,s,r,o){return new Promise((n,i)=>{const a={async:s,filters:t,sorters:r,success:n,error:i};o.read(e,a)})},onReadQueryParameters(e,t,s,r){return new Promise((o,n)=>{const i={filters:t,urlParameters:r,success:o,error:n};s.read(e,i)})},onSubmitChanges(e){return new Promise((t,s)=>{const r={success:t,error:s};e.submitChanges(r)})},onUpdate(e,t,s){return new Promise((r,o)=>{const n={success:r,error:o};s.update(e,t,n)})}})});
//# sourceMappingURL=App.controller.js.map